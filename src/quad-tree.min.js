(function(d){var a=function(g,f){if((g.x+g.width)<=f.x){return false}else{if((f.x+f.width)<=g.x){return false}else{if((g.y+g.height)<=f.y){return false}else{if((f.y+f.height)<=g.y){return false}}}}return true};var c=function(g,f){return g.x>=f.x&&g.y>=f.y&&(g.x+g.width)<=(f.x+f.width)&&(g.y+g.height)<=(f.y+f.height)};var e=function(j,g,f,k,i){var h=this;h.bounds=j;g=parseInt(g);f=parseInt(f);k=parseInt(k);h.max_objects=isNaN(g)?10:g;h.max_levels=isNaN(f)?4:f;h.level=isNaN(k)?0:k;h.nodes=[];h.objects=[];h.object_groups=[];h.qtd=0;h.parent=i===undefined?null:i};e.ID=0;e.prototype.clear=function(){var f=this;f.objects=[];f.object_groups=[];f.qtd=0;var g;for(g=0;g<4;g++){if(f.nodes[g]!==undefined&&f.nodes[g].qtd>0){f.nodes[g].clear()}}};e.prototype.insert=function(k){var h=this;if(k._id===undefined){k._id=e.ID;e.ID++}var f=k.groups;var g=[];if(f===undefined){g=[true]}else{f.forEach(function(i){g[i]=true})}k._groups=g;k._groups.forEach(function(l,i){if(h.object_groups[i]===undefined){h.object_groups[i]=[]}h.object_groups[i][k._id]=k});h.objects[k._id]=k;h.qtd++;if(k._full_inside===undefined){if(!c(k,h.bounds)||h.qtd<=h.max_objects){k._full_inside=h.parent===null?h:h.parent}}if(k._parents===undefined){k._parents=[]}if(k._parents[h.level]===undefined){k._parents[h.level]=[]}k._parents[h.level].push(h);if(h.qtd>h.max_objects&&h.level<h.max_levels){if(h.nodes.length===0){h.split()}if(h.qtd===h.max_objects+1){h.objects.forEach(function(l){for(var i=0;i<4;i++){if(a(l,h.nodes[i].bounds)){h.nodes[i].insert(l)}}})}else{for(var j=0;j<4;j++){if(a(k,h.nodes[j].bounds)){h.nodes[j].insert(k)}}}}};e.prototype.isLeaf=function(){var f=this;return f.qtd<=f.max_objects};e.prototype.split=function(){var i=this;var m=i.level+1;var g=i.bounds.x;var l=i.bounds.y;var k=i.bounds.width/2;var f=i.bounds.height/2;var h=g+k;var j=l+f;i.nodes[0]=new e({x:g,y:l,width:k,height:f},i.max_objects,i.max_levels,m,i);i.nodes[1]=new e({x:h,y:l,width:k,height:f},i.max_objects,i.max_levels,m,i);i.nodes[2]=new e({x:h,y:j,width:k,height:f},i.max_objects,i.max_levels,m,i);i.nodes[3]=new e({x:g,y:j,width:k,height:f},i.max_objects,i.max_levels,m,i)};e.prototype.remove=function(n){var f=this;var o=f.level;var m=n._parents.length;for(var k=o;k<m;k++){var h=n._parents[k];var l=h.length;for(var g=0;g<l;g++){delete h[g].objects[n._id];n._groups.forEach(function(j,i){delete h[g].object_groups[i][n._id]});h[g].qtd--}n._parents[k]=[]}};e.remove=function(k){if(k!==undefined){if(k._parents!==undefined){var i=k._parents.length;for(var l=0;l<i;l++){var g=k._parents[l];var h=g.length;for(var f=0;f<h;f++){delete g[f].objects[k._id];k._groups.forEach(function(m,j){delete g[f].object_groups[j][k._id]});g[f].qtd--}k._parents[l]=[]}}}};e.reInsert=function(g){var f=g._full_inside;while(f.parent!==null&&f.parent!==undefined){f=f.parent}f.remove(g);f.insert(g)};e.getCollisions=function(k,m){var n=k._parents.length-1;var j=[];if(n!==undefined){var f=k._parents[n];var h=f.length;var l=[];for(var g=0;g<h;g++){if(m===undefined){f[g].objects.forEach(function(i,o){if(o!==k._id&&b(i._groups,k._groups)&&l[i._id]===undefined&&a(i,k)){l[i._id]=true;j.push(i)}})}else{if(f[g].object_groups[m]!==undefined){f[g].object_groups[m].forEach(function(i,o){if(o!==k._id&&l[i._id]===undefined&&a(i,k)){l[i._id]=true;j.push(i)}})}}}}return j};function b(h,g){var f=false;h.forEach(function(j,i){if(g[i]!==undefined&&g[i]){f=true;return false}});return f}d.QuadTree=e})(window);