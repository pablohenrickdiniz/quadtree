(function(c){var a=0;var f=function(i,h){var g=this;g.bounds=i;h=h||{};g.max_objects=h.max_objects||10;g.max_levels=h.max_levels||4;g.level=h.level||0;g.nodes=[];g.objects=[];g.groups=[];g.qtd=0;g.parent=h.parent||null;g.loop_x=h.loop_x||false;g.loop_y=h.loop_y||false};f.prototype.getCWidth=function(){var g=this;if(g.parent!=null){return g.parent.getCWidth()}return g.bounds.width};f.prototype.getCHeight=function(){var g=this;if(g.parent!=null){return g.parent.getCHeight()}return g.bounds.height};f.prototype.clear=function(){var g=this;g.objects.forEach(function(k){if(k.parents[g.level]){var i=k.parents[g.level].indexOf(g);if(i!=-1){k.parents[g.level].splice(i,1)}}});g.objects=[];g.groups=[];g.qtd=0;var h;var j=g.nodes.length;for(h=0;h<j;h++){g.nodes[h].clear()}};f.prototype.insert=function(o){var j=this;if(o.id===undefined){o.id=a;a++}if(o.groups===undefined){o.groups=["default"]}var n=o.groups.length;var l;for(l=0;l<n;l++){var p=o.groups[l];if(j.groups[p]===undefined){j.groups[p]=[]}j.groups[p][o.id]=o}j.objects[o.id]=o;if(o.parents==undefined){o.parents=[]}if(o.parents[j.level]==undefined){o.parents[j.level]=[]}var k=o.parents[j.level].indexOf(j);if(k==-1){o.parents[j.level].push(j)}var g=j.getCWidth();var m=j.getCHeight();if(o.xa==undefined){o.xa=d(o.x,g)}if(o.xb==undefined){o.xb=d(o.x+o.width,g)-o.width}if(o.ya==undefined){o.ya=d(o.y,m)}if(o.yb==undefined){o.yb=d(o.y+o.height,m)-o.height}j.qtd++;if(j.qtd>j.max_objects&&j.level<j.max_levels){if(j.nodes.length==0){j.split()}for(l=0;l<4;l++){if(e(o,j.nodes[l].bounds,j.loop_x,j.loop_y)){j.nodes[l].insert(o)}}}};f.prototype.isLeaf=function(){var g=this;return g.qtd<=g.max_objects||g.level==g.max_levels};f.prototype.split=function(){var n=this;var g=n.level+1;var l=n.bounds.x;var j=n.bounds.y;var i=n.bounds.width/2;var m=n.bounds.height/2;var h=l+i;var k=j+m;var o={parent:n,max_objects:n.max_objects,max_levels:n.max_levels,level:g,loop_x:n.loop_x,loop_y:n.loop_y};n.nodes[0]=new f({x:l,y:j,width:i,height:m},o);n.nodes[1]=new f({x:h,y:j,width:i,height:m},o);n.nodes[2]=new f({x:h,y:k,width:i,height:m},o);n.nodes[3]=new f({x:l,y:k,width:i,height:m},o);n.objects.forEach(function(q){for(var p=0;p<4;p++){if(e(q,n.nodes[p].bounds,n.loop_x,n.loop_y)){n.nodes[p].insert(q)}}})};f.prototype.remove=function(g){f.remove(g)};f.prototype.removeGroup=function(k){var g=this;if(g.groups[k]!=undefined){delete g.groups[k]}g.objects.forEach(function(i,l){if(i.groups.indexOf(k)!=-1){delete g.objects[l]}});var j=g.nodes.length;for(var h=0;h<j;h++){g.nodes[h].removeGroup(k)}};f.removeGroup=function(g,q){var n=g.groups.indexOf(q);if(n!=-1){g.groups.splice(n,1)}var k=g.parents;var h;var m;var l;var o;var p;for(m=0;m<k;m++){o=g.parents[m];h=o.length;for(l=0;l<h;l++){p=o[l];if(p.groups[q]!=undefined){delete p.groups[q][g.id]}}}};f.addGroup=function(m,n){if(m.groups.indexOf(n)==-1){m.groups.push(n)}var p=m.parents.length;var o;var k;var h;var g;var l;for(k=0;k<p;k++){g=m.parents[k];o=g.length;for(h=0;h<o;h++){l=g[h];if(l.groups[n]==undefined){l.groups[n]=[]}l.groups[n][m.id]=m}}};f.remove=function(g){var m=g.parents.length;var l;var h;var q;var p;var o;var r;var n;var s;for(p=0;p<m;p++){q=g.parents[p];l=q.length;for(o=0;o<l;o++){r=q[o];delete r.objects[g.id];h=g.groups.length;for(n=0;n<h;n++){s=g.groups[n];if(r.groups[s]!=undefined){delete r.groups[s][g.id]}}r.qtd--;if(r.qtd<=r.max_objects&&r.nodes.length>0){r.nodes=[]}}}g.parents=[];delete g.xa;delete g.xb;delete g.ya;delete g.yb};f.reInsert=function(h){if(h.parents.length>0){var g=h.parents[0][0];while(g.parent instanceof f){g=g.parent}g.remove(h);g.insert(h)}};f.prototype.retrieve=function(i,j){var g=this;g.insert(i);var h=f.getCollisions(i,j);g.remove(i);return h};f.getCollisions=function(g,r){var m=g.parents.length-1;var l;var k;var p=[];var s=[];var h;var q;for(l=m;l>=0;l--){h=g.parents[l].length;for(k=0;k<h;k++){q=g.parents[l][k];if(q.isLeaf()){var o=q.loop_x;var n=q.loop_y;if(r===undefined){q.objects.forEach(function(i,t){if(t!==g.id&&s[i.id]===undefined){var j=e(g,i,o,n);if(j){s[i.id]=true;j=Object.assign(j,{object:i._ref});p.push(j)}}})}else{if(q.groups[r]!==undefined){q.groups[r].forEach(function(i,t){if(t!==g.id&&s[i.id]===undefined){var j=e(g,i,o,n);if(j){s[i.id]=true;j=Object.assign(j,{object:i._ref});p.push(j)}}})}}}}}return p};function e(A,z,C,B){var y=[A.x];var h=[A.y];var v=[z.x];var g=[z.y];var w;if(C){if(A.xa!=undefined&&y.indexOf(A.xa)==-1){y.push(A.xa)}if(A.xb!=undefined&&y.indexOf(A.xb)==-1){y.push(A.xb)}if(z.xa!=undefined&&v.indexOf(z.xa)==-1){v.push(z.xa)}if(z.xb!=undefined&&v.indexOf(z.xb)==-1){v.push(z.xb)}}if(B){if(A.ya!=undefined&&h.indexOf(A.ya)==-1){h.push(A.ya)}if(A.yb!=undefined&&h.indexOf(A.yb)==-1){h.push(A.yb)}if(z.ya!=undefined&&g.indexOf(z.ya)==-1){g.push(z.ya)}if(z.yb!=undefined&&g.indexOf(z.yb)==-1){g.push(z.yb)}}var r=y.length;var q=h.length;var p=v.length;var o=g.length;var x;var u;var t;var s;var n;var m;for(x=0;x<r;x++){for(u=0;u<q;u++){for(t=0;t<p;t++){for(s=0;s<o;s++){n={x:y[x],y:h[u],width:A.width,height:A.height};m={x:v[t],y:g[s],width:z.width,height:z.height};w=b(n,m);if(w){return w}}}}}return false}function d(h,g){if(h<0){while(h<-g){h=h%g}return g+h}else{if(h>g){while(h>g){h=h%g}return h}}return h}function b(h,g){if((h.x+h.width)<=g.x){return false}else{if((g.x+g.width)<=h.x){return false}else{if((h.y+h.height)<=g.y){return false}else{if((g.y+g.height)<=h.y){return false}}}}return{xa:h.x,xb:g.x,ya:h.y,yb:g.y,wa:h.width,wb:g.width,ha:h.height,hb:g.height}}c.QuadTree=f})(window);