(function(c){var a=0;var e=function(j,g,f,k,i){var h=this;h.bounds=j;g=parseInt(g);f=parseInt(f);k=parseInt(k);h.max_objects=isNaN(g)?10:g;h.max_levels=isNaN(f)?4:f;h.level=isNaN(k)?0:k;h.nodes=[];h.objects=[];h.groups=[];h.qtd=0;h.parent=i===undefined?null:i};e.prototype.clear=function(){var f=this;f.objects.forEach(function(j){if(j.parents[f.level]){var i=j.parents[f.level].indexOf(f);if(i!=-1){j.parents[f.level].splice(i,1)}}});f.objects=[];f.groups=[];f.qtd=0;var g;var h=f.nodes.length;for(g=0;g<h;g++){f.nodes[g].clear()}};e.prototype.insert=function(k){var f=this;if(k.id===undefined){k.id=a;a++}if(k.groups===undefined){k.groups=["default"]}var j=k.groups.length;var h;for(h=0;h<j;h++){var l=k.groups[h];if(f.groups[l]===undefined){f.groups[l]=[]}f.groups[l][k.id]=k}f.objects[k.id]=k;if(k.parents==undefined){k.parents=[]}if(k.parents[f.level]==undefined){k.parents[f.level]=[]}var g=k.parents[f.level].indexOf(f);if(g==-1){k.parents[f.level].push(f)}f.qtd++;if(f.qtd>f.max_objects&&f.level<f.max_levels){if(f.nodes.length==0){f.split()}for(h=0;h<4;h++){if(b(k,f.nodes[h].bounds)){f.nodes[h].insert(k)}}}};e.prototype.isLeaf=function(){var f=this;return f.qtd<=f.max_objects};e.prototype.split=function(){var i=this;var m=i.level+1;var g=i.bounds.x;var l=i.bounds.y;var k=i.bounds.width/2;var f=i.bounds.height/2;var h=g+k;var j=l+f;i.nodes[0]=new e({x:g,y:l,width:k,height:f},i.max_objects,i.max_levels,m,i);i.nodes[1]=new e({x:h,y:l,width:k,height:f},i.max_objects,i.max_levels,m,i);i.nodes[2]=new e({x:h,y:j,width:k,height:f},i.max_objects,i.max_levels,m,i);i.nodes[3]=new e({x:g,y:j,width:k,height:f},i.max_objects,i.max_levels,m,i);i.objects.forEach(function(o){for(var n=0;n<4;n++){if(b(o,i.nodes[n].bounds)){i.nodes[n].insert(o)}}})};e.prototype.remove=function(f){e.remove(f)};e.prototype.removeGroup=function(j){var f=this;if(f.groups[j]!=undefined){delete f.groups[j]}f.objects.forEach(function(i,k){if(i.groups.indexOf(j)!=-1){delete f.objects[k]}});var h=f.nodes.length;for(var g=0;g<h;g++){f.nodes[g].removeGroup(j)}};e.removeGroup=function(f,p){var m=f.groups.indexOf(p);if(m!=-1){f.groups.splice(m,1)}var h=f.parents;var g;var l;var k;var n;var o;for(l=0;l<h;l++){n=f.parents[l];g=n.length;for(k=0;k<g;k++){o=n[k];if(o.groups[p]!=undefined){delete o.groups[p][f.id]}}}};e.addGroup=function(l,m){if(l.groups.indexOf(m)==-1){l.groups.push(m)}var o=l.parents.length;var n;var h;var g;var f;var k;for(h=0;h<o;h++){f=l.parents[h];n=f.length;for(g=0;g<n;g++){k=f[g];if(k.groups[m]==undefined){k.groups[m]=[]}k.groups[m][l.id]=l}}};e.remove=function(f){var l=f.parents.length;var h;var g;var p;var o;var n;var q;var m;var r;for(o=0;o<l;o++){p=f.parents[o];h=p.length;for(n=0;n<h;n++){q=p[n];delete q.objects[f.id];g=f.groups.length;for(m=0;m<g;m++){r=f.groups[m];if(q.groups[r]!=undefined){delete q.groups[r][f.id]}}q.qtd--;if(q.qtd<=q.max_objects&&q.nodes.length>0){q.nodes=[]}}}f.parents=[]};e.reInsert=function(g){if(g.parents.length>0){var f=g.parents[0][0];while(f.parent instanceof e){f=f.parent}f.remove(g);f.insert(g)}};e.prototype.retrieve=function(h,i){var f=this;f.insert(h);var g=e.getCollisions(h,i);f.remove(h);return g};e.getCollisions=function(k,m){var n=k.parents.length-1;var j=[];if(n!==undefined){var f=k.parents[n];var h=f.length;var l=[];for(var g=0;g<h;g++){if(m===undefined){f[g].objects.forEach(function(i,o){if(o!==k.id&&d(i.groups,k.groups)&&l[i.id]===undefined&&b(i,k)){l[i.id]=true;j.push(i)}})}else{if(f[g].groups[m]!==undefined){f[g].groups[m].forEach(function(i,o){if(o!==k.id&&l[i.id]===undefined&&b(i,k)){l[i.id]=true;j.push(i)}})}}}}return j};function d(k,h){var g=k.length;var f=h.length;for(var m=0;m<g;m++){for(var l=0;l<f;l++){if(k[m]==h[l]){return true}}}return false}function b(g,f){if((g.x+g.width)<=f.x){return false}else{if((f.x+f.width)<=g.x){return false}else{if((g.y+g.height)<=f.y){return false}else{if((f.y+f.height)<=g.y){return false}}}}return true}c.QuadTree=e})(window);